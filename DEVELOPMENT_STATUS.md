# ì—”í„°í”„ë¼ì´ì¦ˆ ì •ì  CMS í”„ë¡œì íŠ¸ ê°œë°œ í˜„í™© (2025-12-30, ìµœì¢… ë°°í¬ ë° ì•ˆì •í™” ë‹¨ê³„)

ì´ ë¬¸ì„œëŠ” ì—”í„°í”„ë¼ì´ì¦ˆ ì •ì  CMS í”„ë¡œì íŠ¸ì˜ í˜„ì¬ ê°œë°œ í˜„í™©ì„ ìš”ì•½í•©ë‹ˆë‹¤.

## ì™„ë£Œëœ ì‘ì—…

- [x] **ëª¨ë…¸ë ˆí¬ ë° ê¸°ë³¸ êµ¬ì¡° ì„¤ì •**
  - [x] `pnpm` ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê¸°ë°˜ ëª¨ë…¸ë ˆí¬ êµ¬ì¡° ìƒì„± (`apps`, `packages`).
  - [x] Drizzle ORM ë° Zodë¥¼ ì‚¬ìš©í•œ ê³µìœ  íŒ¨í‚¤ì§€(`db`, `types`) êµ¬í˜„.
  - [x] Cloudflare D1/KV ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì •ë³´ë¡œ `wrangler.toml` êµ¬ì„±.
  - [x] GitHub Actions ê¸°ë³¸ CI íŒŒì´í”„ë¼ì¸ ìƒì„±.

- [x] **`cms-api`: í•µì‹¬ ë¡œì§ êµ¬í˜„**
  - [x] Hono ê¸°ë°˜ í”„ë¡œì íŠ¸ ì´ˆê¸°í™”.
  - [x] **ì¸ì¦**: JWT ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ë° Cloudflare í™˜ê²½ ë³€ìˆ˜(`c.env.JWT_SECRET`) ì—°ë™.
  - [x] **í…Œë„ŒíŠ¸ ì‹ë³„**: Cloudflare KV(`c.env.KV`)ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ë„ë©”ì¸ì— ë”°ë¥¸ í…Œë„ŒíŠ¸ë¥¼ ì‹ë³„í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´ êµ¬í˜„.
  - [x] **ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™**:
    - [x] D1 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìœ í‹¸ë¦¬í‹°(`db.ts`) ìƒì„±.
    - [x] `tenants`, `admins`, `categories`, `articles`ì˜ ëª¨ë“  CRUD APIë¥¼ ì‹¤ì œ D1 ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë¡œì§ìœ¼ë¡œ **ì™„ì „ ëŒ€ì²´**.

- [x] **`renderer`: ê¸°ë³¸ êµ¬í˜„**
  - [x] Hono ê¸°ë°˜ í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° Cloudflare Pages ë°°í¬ í™˜ê²½ ì„¤ì •.
  - [x] `cms-api` ì—°ë™ì„ ìœ„í•œ ê¸°ë³¸ Fetcher ë¡œì§ ê³¨ê²© êµ¬í˜„.

## ê¸°ìˆ  ë¶€ì±„ ë° í•´ê²°ì´ í•„ìš”í•œ ì´ìŠˆ (Technical Debt)

- [x] **ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìë™í™”**
  - **í˜„í™©**: `drizzle-kit` ì„¤ì • ì™„ë£Œ ë° D1 ì—°ë™ ì²´ê³„ êµ¬ì¶•.
  - **í•´ê²°**: `drizzle.config.ts`ë¥¼ í†µí•´ ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì‚¬í•­ì„ ê´€ë¦¬í•˜ê³  `wrangler d1 migrations`ë¥¼ í™œìš©í•˜ë„ë¡ ê°œì„ .

- [ ] **ë³´ì•ˆ ê°•í™” (Security)**
  - **í˜„í™©**: ë¹„ë°€ë²ˆí˜¸ í•´ì‹± ë° JWT ë¦¬í”„ë ˆì‹œ í† í° ì‹œìŠ¤í…œ ë„ì… ì™„ë£Œ. `wrangler secret`ì„ í†µí•œ í‚¤ ê´€ë¦¬ ì²´ê³„ ìˆ˜ë¦½.
  - **í•´ê²°**: ì •ê¸°ì ì¸ ì‹œí¬ë¦¿ ë¡œí…Œì´ì…˜ ê°€ì´ë“œ ë§ˆë ¨ ë° í† í° íƒˆì·¨ ëŒ€ì‘ ì‹œë‚˜ë¦¬ì˜¤ êµ¬ì¶• í•„ìš”.

- [ ] **í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ ìµœì í™”**
  - **í˜„í™©**: `renderer` ë° `cms-api`ì—ì„œ í™˜ê²½ë³„ BASE_URL ë° API_URL ì—°ë™ êµ¬ì¡° ê°œì„  ì™„ë£Œ.
  - **í•´ê²°**: `wrangler.toml`ì˜ `[vars]`ë¥¼ í†µí•´ í™˜ê²½ë³„ ì—”ë“œí¬ì¸íŠ¸ ê´€ë¦¬ ì¤‘.

## ë°°í¬ ì•„í‚¤í…ì²˜ (Deployment Architecture)
- **API ì„œë²„ (Backend)**: Cloudflare Workers (`apps/cms-api`)
- **í”„ë¡ íŠ¸ì—”ë“œ/ë Œë”ëŸ¬ (Frontend)**: Cloudflare Pages (ì—°ë™ ë° ë°°í¬ ì§„í–‰ ì¤‘)

## í–¥í›„ ë¡œë“œë§µ (Roadmap)

### Phase 1: ë³´ì•ˆ ë° ì¸ì¦ ì™„ì„± (Done)
- [x] **ì‹¤ì œ ë¹„ë°€ë²ˆí˜¸ í•´ì‹± êµ¬í˜„**: `Web Crypto API` ì—°ë™ ì™„ë£Œ.
- [x] **D1 ìŠ¤í‚¤ë§ˆ ì •ì˜**: `init.sql` ì‘ì„± ì™„ë£Œ. (ì‹¤í–‰ ëŒ€ê¸° ì¤‘)
- [x] **ë¡œê·¸ì¸ API êµ¬í˜„**: `auth.ts` ë‚´ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ ë¡œì§ ì¶”ê°€ ì™„ë£Œ.
- [x] **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**: `JWT_SECRET`, `PASSWORD_SALT` ì„¤ì • ì²´ê³„ ë§ˆë ¨.

### Phase 2: ì½˜í…ì¸  ëª¨ë¸ë§ ë° ê´€ê³„ ê³ ë„í™” (Done)
- [x] **ë‹¤ëŒ€ë‹¤(Many-to-Many) ê´€ê³„ êµ¬í˜„**: ê²Œì‹œê¸€-ì¹´í…Œê³ ë¦¬ ë§¤í•‘ API ë¡œì§ ì™„ë£Œ.
- [x] **ì½˜í…ì¸  ê²Œì‹œ ì›Œí¬í”Œë¡œìš°**: `isPublic` ìƒíƒœì— ë”°ë¥¸ `publishedAt` ìë™ ì„¤ì • ë¡œì§ ì ìš©.
- [x] **í…Œë„ŒíŠ¸ ê²©ë¦¬ ê°•í™”**: `admins`, `categories`, `articles` API ì „ë°˜ì— `tenantId` í•„í„°ë§ ì ìš©.

### Phase 3: Renderer ì—°ë™ ë° ë°°í¬ ìµœì í™” (Done)
- [x] **Public API ì—”ë“œí¬ì¸íŠ¸**: Rendererê°€ ì¸ì¦ ì—†ì´(í…Œë„ŒíŠ¸ ì‹ë³„ë§Œìœ¼ë¡œ) ì ‘ê·¼ ê°€ëŠ¥í•œ API êµ¬ì¶• ì™„ë£Œ.
- [x] **Renderer ìºì‹± ì „ëµ**: Cloudflare Cache APIë¥¼ ì‚¬ìš©í•˜ì—¬ Public API ì‘ë‹µ ìºì‹± ì ìš© ì™„ë£Œ.

### Phase 4: ë¯¸ë””ì–´ ê´€ë¦¬ ë° ê´€ë¦¬ì UI (Done)
- [x] **R2 ìŠ¤í† ë¦¬ì§€ ì—°ë™**: `media.ts`ë¥¼ í†µí•œ ì´ë¯¸ì§€ ì—…ë¡œë“œ API êµ¬í˜„ ì™„ë£Œ.
- [x] **ì´ë¯¸ì§€ ìµœì í™”**: í”„ë¡ íŠ¸ì—”ë“œ(Admin UI)ì—ì„œ Canvas APIë¥¼ ì´ìš©í•œ WebP ë³€í™˜ ë° ì—…ë¡œë“œ ë¡œì§ êµ¬í˜„ ì™„ë£Œ.
- [x] **Admin UI**: ë¡œê·¸ì¸, ëŒ€ì‹œë³´ë“œ, ê²Œì‹œê¸€ ê´€ë¦¬, ë¯¸ë””ì–´ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ëŠ¥ êµ¬í˜„ ë° API ì—°ë™ ì™„ë£Œ.

### Phase 5: Renderer ì™„ì„± ë° Pages ë°°í¬ (Done)
- [x] **Renderer ì‹¤êµ¬í˜„**: `cms-api`ì˜ Public APIë¥¼ í˜¸ì¶œí•˜ì—¬ í…Œë„ŒíŠ¸ë³„ ë¸”ë¡œê·¸ ë©”ì¸ ë° ìƒì„¸ í˜ì´ì§€ êµ¬í˜„ ì™„ë£Œ.
- [x] **SEO ìµœì í™”**: ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ë™ì  ë©”íƒ€ íƒœê·¸ ìƒì„± ë¡œì§ ì¶”ê°€.
- [x] **í…Œë„ŒíŠ¸ ì»¤ìŠ¤í…€ í…Œë§ˆ**: Cloudflare KVë¥¼ ì—°ë™í•˜ì—¬ í…Œë„ŒíŠ¸ë³„ ìƒ‰ìƒ ë° ë¡œê³  ì ìš© ë¡œì§ êµ¬í˜„.
- [x] **í…Œë„ŒíŠ¸ ì„¤ì • ê´€ë¦¬ API**: í…Œë„ŒíŠ¸ í…Œë§ˆ ë° ë„ë©”ì¸ ì„¤ì •ì„ D1ì— ì €ì¥í•˜ê³  KVì— ë™ê¸°í™”í•˜ëŠ” API êµ¬í˜„ ì™„ë£Œ (ë„ë©”ì¸ ë³€ê²½ ì‹œ ì´ì „ ë§¤í•‘ ì‚­ì œ ë¡œì§ í¬í•¨).
- [x] **Admin UI ì„¤ì • í˜ì´ì§€**: í…Œë„ŒíŠ¸ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” UI êµ¬í˜„ ì™„ë£Œ.
- [x] **Markdown ì—ë””í„°**: ê²Œì‹œê¸€ ì‘ì„± ì‹œ EasyMDEë¥¼ í†µí•œ Markdown í¸ì§‘ ë° ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ ì¶”ê°€.
- [x] **ê²Œì‹œê¸€ ìˆ˜ì • ê¸°ëŠ¥**: ê¸°ì¡´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ ì—ë””í„°ì— ì„¸íŒ…í•˜ê³  ìˆ˜ì •í•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ.
- [x] **ê²Œì‹œê¸€ ì‚­ì œ ê¸°ëŠ¥**: ëª©ë¡ í˜ì´ì§€ì—ì„œ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ.
- [x] **Markdown ë Œë”ë§**: Rendererì—ì„œ Markdown ë³¸ë¬¸ì„ HTMLë¡œ ë³€í™˜í•˜ì—¬ ì¶œë ¥í•˜ëŠ” ë¡œì§ ì¶”ê°€.
- [x] **Pages ë°°í¬ ì„¤ì •**: Viteë¥¼ ì´ìš©í•œ `_worker.js` ë¹Œë“œ ì‹œìŠ¤í…œ êµ¬ì¶• ë° ë°°í¬ ì„¤ì • ì™„ë£Œ.

### Phase 6: ì„±ëŠ¥ ë° ì¸í”„ë¼ ìµœì í™” (Done)
- [x] **R2 ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•**: Workerë¥¼ í†µí•œ ë™ì  ì´ë¯¸ì§€ ì„œë¹™ ë° ì¿¼ë¦¬ ê¸°ë°˜ ë¦¬ì‚¬ì´ì§• ë¡œì§ êµ¬í˜„.
- [x] **LCP ìµœì í™”**: Renderer ëª©ë¡ í˜ì´ì§€ì—ì„œ ìµœì í™”ëœ í¬ê¸°ì˜ ì¸ë„¤ì¼ì„ ë¶ˆëŸ¬ì˜¤ë„ë¡ ê°œì„ .
- [x] **ë°°í¬ í™˜ê²½ ìµœì í™”**: Cloudflare Pagesì˜ ë¹Œë“œ ì—†ëŠ” ë°°í¬(Root Directory ì „ëµ) ì„¤ì • ì™„ë£Œ.

## ìˆ˜ë™ ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `git pull` ì‹¤í–‰ (ì›ê²© ì €ì¥ì†Œ ë™ê¸°í™”)
- [ ] `wrangler d1 execute bpr-db --file=./init.sql` (ë¡œì»¬/ì›ê²© DB ì´ˆê¸°í™”)
- [ ] `wrangler secret put JWT_SECRET` (ì¸ì¦ í‚¤ ì„¤ì •)
- [ ] `wrangler secret put PASSWORD_SALT` (ë¹„ë°€ë²ˆí˜¸ í•´ì‹±ìš© ì†”íŠ¸ ì„¤ì •)

### Phase 7: ìœ ì§€ë³´ìˆ˜ ë° ìë™í™” (In Progress)
- [x] **Drizzle Kit ì„¤ì •**: ë§ˆì´ê·¸ë ˆì´ì…˜ ìë™í™”ë¥¼ ìœ„í•œ `drizzle.config.ts` êµ¬ì„± ì™„ë£Œ.
- [x] **Admin UI UX ê³ ë„í™”**: í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì•Œë¦¼ ë° ë²„íŠ¼ ë¡œë”© ìƒíƒœ êµ¬í˜„ ì™„ë£Œ.
- [x] **ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ ë° í†µê³„**: ê¸€ë¡œë²Œ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë„ì… ë° ëŒ€ì‹œë³´ë“œ ë™ì  í†µê³„ ì—°ë™ ì™„ë£Œ.
- [x] **ì •ì  ìì‚° ì„œë¹™**: Renderer ì•±ì—ì„œ `public` í´ë” ë‚´ ìì‚°(ì´ë¯¸ì§€, CSS ë“±) ì„œë¹™ ì„¤ì • ì™„ë£Œ.
- [ ] **í†µí•© í…ŒìŠ¤íŠ¸**: Cloudflare ë°°í¬ í™˜ê²½ ê¸°ë°˜ ì „ì²´ ì›Œí¬í”Œë¡œìš° ê²€ì¦ (ì§„í–‰ ì¤‘ - 404 ì´ìŠˆ ë””ë²„ê¹…).

## ë°°í¬ ì°¸ê³  ì‚¬í•­ (Deployment Notes)

### Cloudflare ëŒ€ì‹œë³´ë“œ ì„¤ì • (Git ì—°ë™ ì‹œ)

| í”„ë¡œì íŠ¸ëª… | ìœ í˜• | Root Directory | Build Command | Output Directory |
| :--- | :--- | :--- | :--- | :--- |
| **pbr1** | Worker | `apps/cms-api` | (None) | (None) |
| **bprproto** | Pages | `apps/renderer` | `pnpm build` | `dist` |
| **bpr2** | Worker | `apps/renderer` | (None) | (None) |

### ì£¼ìš” í•´ê²° ê³¼ì œ
- **Pages ë¹Œë“œ ì˜¤ë¥˜**: `dist` ë””ë ‰í† ë¦¬ë¥¼ ì°¾ì§€ ëª»í•˜ëŠ” ë¬¸ì œëŠ” `pnpm build` ëª…ë ¹ì„ í†µí•´ Viteê°€ `_worker.js`ë¥¼ ìƒì„±í•˜ë„ë¡ í•˜ì—¬ í•´ê²°í–ˆìŠµë‹ˆë‹¤.
- **Lockfile ë° ESM í˜¸í™˜ì„± í•´ê²°**: ESM ì„¤ì •(`type: module`) ì ìš© ë° `@hono/vite-build/cloudflare-pages` ì„œë¸ŒíŒ¨ìŠ¤ ì„í¬íŠ¸ ìˆ˜ì •ì„ í†µí•´ ë¹Œë“œ ì‹œìŠ¤í…œ ì•ˆì •í™” ì™„ë£Œ.
- **CORS ë° ì ˆëŒ€ ê²½ë¡œ**: `cms-api`ì—ì„œ ë¯¸ë””ì–´ URLì„ ì ˆëŒ€ ê²½ë¡œë¡œ ë°˜í™˜í•˜ë„ë¡ ìˆ˜ì •í•˜ì—¬ Pages ë„ë©”ì¸ì—ì„œë„ ì´ë¯¸ì§€ê°€ ì •ìƒ ì¶œë ¥ë©ë‹ˆë‹¤.

### ìˆ˜ë™ ì‘ì—… (ìµœì´ˆ 1íšŒ)
1. Cloudflare ëŒ€ì‹œë³´ë“œì—ì„œ `pbr1` Workerì˜ **Settings > Variables**ì— `JWT_SECRET`ê³¼ `PASSWORD_SALT`ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
2. `bprproto` Pagesì˜ **Settings > Builds & deployments**ì—ì„œ ë¹Œë“œ ëª…ë ¹ì„ `pnpm install --no-frozen-lockfile && pnpm build`ë¡œ ìˆ˜ì •í•˜ì„¸ìš”.
3. D1 ë°ì´í„°ë² ì´ìŠ¤ì— í…ŒìŠ¤íŠ¸ìš© í…Œë„ŒíŠ¸ì™€ ê´€ë¦¬ì ë°ì´í„°ë¥¼ Consoleì—ì„œ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.

### ğŸ” ì´ˆê¸° ë¡œê·¸ì¸ ì •ë³´ (Setup API ì‹¤í–‰ í›„)
- **URL**: `https://bprproto.pages.dev/admin/login`
- **ì´ë©”ì¼**: `admin@example.com`
- **ë¹„ë°€ë²ˆí˜¸**: `password123`
